<script type="module">
	if(window !== window.top) {

		const { data: port } = await new Promise(r_port => globalThis.onmessage = r_port);

		const
			loader = document.querySelector("iframe"),
			registration = localStorage.getItem("profile"),
			name = decodeURIComponent(Object.fromEntries(new URLSearchParams(window.location.search).entries()).name) || "localhost"
		;

		let portStr;

		while(registration.includes(
			portStr = `${name}-${Math.floor(Math.random() * (36 ** 8 - 1)).toString(36).padStart(6, "0")}`
		)){}

		loader.src = `https://${portStr}.weblocal.dev`;
		await new Promise(r_loader => loader.onload = r_loader);
		
		loader.contentWindow.postMessage(port, loader.src, [port]);
		localStorage.setItem("profile", `${registration}\0${portStr}`)
	}
</script>
<iframe></iframe>